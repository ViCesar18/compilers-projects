#include <stdio.h>
#include <stdbool.h>
#include "lexico.h"

int getToken() {
    int automaton[][28] = {
                   /*b  d  e  f  g  h  i  l  n  p  r  s  t  0  1  2  3  4  5  6  7  8  9  ;  +  -  =  final?*/
        /*State 0*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 1*/ {12, 0, 8, 0, 0, 0, 2, 0, 0, 19, 0, 0, 4, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 24, 25, 25, 27, 0},
        /*State 2*/ {0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 3*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},  //IF
        /*State 4*/ {0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 5*/ {0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 6*/ {0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 7*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //THEN
        /*State 8*/ {0, 0, 0, 0, 0, 0, 0, 9, 17, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        /*State 9*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 10*/ {0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 11*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //ELSE
       /*State 12*/ {0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 13*/ {0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 14*/ {0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 15*/ {0, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 16*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //BEGIN
       /*State 17*/ {0, 18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 18*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //END
       /*State 19*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 20*/ {0, 0, 0, 0, 0, 0, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 21*/ {0, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 22*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
       /*State 23*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //PRINT
       /*State 24*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},   //SEMI
       /*State 25*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 0, 0, 0, 0, 0},
       /*State 26*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 0, 0, 0, 0, 1},   //NUM
       /*State 27*/ {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}   //EQ
    };

    char c;
    int lastFinal = 0, currentState = 1;

    c = getc(stdin);

    while(true) {
        int column;

        if(c >= '0' && c <= '9') {
            column = c - '0' + 13;
        }
        else if (c == 'b') {
            column = 0;
        }
        else if (c == 'd') {
            column = 1;
        }
        else if( c >= 'e' && c <= 'i') {
            column = c - 'e' + 2;
        }
        else if(c == 'l') {
            column = 7;
        }
        else if(c == 'n') {
            column = 8;
        }
        else if(c == 'p') {
            column = 9;
        }
        else if(c >= 'r' && c <= 't') {
            column = c - 'r' + 10;
        }
        else if(c == ';') {
            column = 23;
        }
        else if(c == '+') {
            column = 24;
        }
        else if(c == '-') {
            column = 25;
        }
        else if(c == '=') {
            column = 26;
        }
        else {
            column = -1;
        }
        

        int nextState;
        if(column == -1) {
            nextState = 0;
        }
        else {
            nextState = automaton[currentState][column];
        }

        if(nextState == 0) {
            if(!feof(stdin) && currentState != 1)  //Caso termine de ler a cadeia, mas não seja o final do arquivo e
                fseek(stdin, -1, SEEK_CUR);        //nem um estado não final, volta um caractere na entrada padrão

            switch (currentState) {
                case 3:
                    return IF;

                case 7:
                    return THEN;

                case 11:
                    return ELSE;

                case 16:
                    return BEGIN;

                case 18:
                    return END;
                
                case 23:
                    return PRINT;
                
                case 24:
                    return SEMI;

                case 26:
                    return NUM;
                
                case 27:
                    return EQ;

                default:
                    return -1;
            }
        }
        else {
            c = getc(stdin);
        }

        currentState = nextState;
        if(automaton[currentState][27] == 1) {
            lastFinal = currentState;
        }
    }
}